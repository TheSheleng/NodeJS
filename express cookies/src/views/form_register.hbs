<section class="vh-100" style="background-color: #eee;">
  <div class="container h-100">
    <div class="row d-flex justify-content-center align-items-center h-100">
      <div class="col-lg-12 col-xl-11">
        <div class="card text-black" style="border-radius: 25px;">
          <div class="card-body p-md-5">
            <div class="row justify-content-center">
              <div class="col-md-10 col-lg-6 col-xl-5 order-2 order-lg-1">

                <p class="text-center h1 fw-bold mb-5 mx-1 mx-md-4 mt-4">Sign up</p>

                <div id="error-message" class="alert alert-danger" role="alert"></div>

                <form id="registerForm" class="mx-1 mx-md-4" method="POST">

                  <div class="d-flex flex-row align-items-center mb-4">
                    <i class="fas fa-user fa-lg me-3 fa-fw"></i>
                    <div
                      data-mdb-input-init
                      class="form-outline flex-fill mb-0"
                    >
                      <input
                        id="registerLoginInput"
                        type="text"
                        class="form-control"
                        name="login"
                        required
                      />
                      <label class="form-label" for="registerLoginInput">Your Login</label>
                    </div>
                  </div>

                  <div class="d-flex flex-row align-items-center mb-4">
                    <i class="fas fa-envelope fa-lg me-3 fa-fw"></i>
                    <div
                      data-mdb-input-init
                      class="form-outline flex-fill mb-0"
                    >
                      <input
                        id="registerEmailInput"
                        type="email"
                        class="form-control"
                        name="email"
                        required
                      />
                      <label class="form-label" for="registerEmailInput">Your Email</label>
                    </div>
                  </div>

                  <div class="d-flex flex-row align-items-center mb-4">
                    <i class="fas fa-lock fa-lg me-3 fa-fw"></i>
                    <div
                      data-mdb-input-init
                      class="form-outline flex-fill mb-0"
                    >
                      <input
                        id="registerPasswordInput"
                        type="password"
                        class="form-control"
                        name="password"
                        required
                      />
                      <label class="form-label" for="registerPasswordInput">Password</label>
                    </div>
                  </div>

                  <div class="d-flex flex-row align-items-center mb-4">
                    <i class="fas fa-key fa-lg me-3 fa-fw"></i>
                    <div
                      data-mdb-input-init
                      class="form-outline flex-fill mb-0"
                    >
                      <input
                        id="registerConfirmPasswordInput"
                        type="password"
                        class="form-control"
                        name="confirm_password"
                        required
                      />
                      <label class="form-label" for="registerConfirmPasswordInput">Repeat your password</label>
                    </div>
                  </div>

                  <div class="d-flex justify-content-center mx-4 mb-3 mb-lg-4">
                    <button
                      type="submit"
                      data-mdb-button-init
                      data-mdb-ripple-init
                      class="btn btn-primary btn-lg"
                    >Register</button>
                  </div>

                </form>

              </div>
              <div
                class="col-md-10 col-lg-6 col-xl-7 d-flex align-items-center order-1 order-lg-2"
              >

                <img
                  src="/images/draw1.webp"
                  class="img-fluid"
                  alt="Sample image"
                />

              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
document.getElementById('registerForm').addEventListener('submit', async (event) => {
  event.preventDefault(); // Отменяем стандартное поведение формы

  const login = document.getElementById('registerLoginInput').value;
  const email = document.getElementById('registerEmailInput').value;
  const password = document.getElementById('registerPasswordInput').value;
  const confirm_password = document.getElementById('registerConfirmPasswordInput').value;

  try {
    const response = await fetch('/user/signup', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ login, email, password, confirm_password }),
    });

    if (response.ok) {
        const data = await response.json();
        const token = data.token;

        // Сохраняем токен в localStorage
        localStorage.setItem('token', token);
        console.log('Токен сохранен в localStorage:', token);

        // Перенаправляем на главную страницу или страницу профиля
        window.location.href = '/'; // Или '/profile' для профиля
    } else {
        // Обработка ошибки
        const errorMessage = document.getElementById('error-message');
        errorMessage.textContent = result.error;
        errorMessage.style.display = 'block';
    }
  } catch (error) {
    console.error('Ошибка при отправке формы:', error);

    const errorMessage = document.getElementById('error-message');
    errorMessage.textContent = result.error;
    errorMessage.style.display = 'block';
  }
});
</script>